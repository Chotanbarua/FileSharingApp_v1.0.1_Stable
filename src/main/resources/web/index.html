<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Sharing App - Web UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f7fb;
            margin: 0;
        }
        .wrapper {
            max-width: 900px;
            margin: 20px auto;
            background: #fff;
            padding: 20px 24px 26px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        h1 {
            margin: 0 0 16px;
            color: #1f6feb;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        h1 span {
            font-size: 32px;
        }
        label {
            display: block;
            margin-top: 14px;
            font-weight: 600;
            font-size: 14px;
        }
        input, select {
            width: 100%;
            padding: 9px 10px;
            margin-top: 4px;
            border-radius: 6px;
            border: 1px solid #d0d7de;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            margin-top: 20px;
            padding: 11px 22px;
            background: #1f6feb;
            color: #fff;
            border: none;
            border-radius: 999px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        button:hover {
            background: #144a9b;
        }
        .small {
            font-size: 12px;
            color: #57606a;
        }
        .ip-box {
            padding: 10px 12px;
            background: #f0f4ff;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
        }
        #status {
            margin-top: 10px;
            min-height: 16px;
        }
        #status.ok    { color: #137333; }
        #status.warn  { color: #b36b00; }
        #status.error { color: #b3261e; }
    </style>
</head>
<body>
<div class="wrapper">
    <h1><span>üìÅ</span> <span>File Sharing App - Web UI</span></h1>

    <div class="ip-box">
        <div>Your IP (share this with your partner): <strong id="userIP">localhost</strong></div>
        <div class="small">
            If you're on the same Wi-Fi, share this IP with your partner.
            For remote transfers, agree on HTTP URL, ZeroTier Network ID, or S3 details.
        </div>
    </div>

    <form id="transferForm">
        <label for="name">Your Name</label>
        <input id="name" type="text" placeholder="Enter your name"/>

        <label for="role">Role</label>
        <select id="role">
            <option value="Sender">Sender</option>
            <option value="Receiver">Receiver</option>
        </select>

        <label for="method">Transfer Method</label>
        <select id="method">
            <option value="HTTP">HTTP (Simple / LAN)</option>
            <option value="ZeroTier">ZeroTier (Secure P2P)</option>
            <option value="S3">AWS S3 (Cloud)</option>
        </select>

        <!-- One shared control; behavior changes by Role -->
        <label for="file" id="fileLabel">File (Sender only)</label>
        <input id="file" type="file"/>

        <label for="target">Target IP / URL / Bucket</label>
        <input
                id="target"
                type="text"
                placeholder="HTTP: Receiver IP or http://host:port ¬∑ ZeroTier: 16-digit Network ID ¬∑ S3: Bucket name or presigned URL"
        />
        <div class="small">
            HTTP ‚ûú Receiver's IP / URL for the upload. |
            ZeroTier ‚ûú Shared 16-digit Network ID. |
            S3 ‚ûú Shared bucket name or presigned URL you both use.
        </div>

        <label for="port">Port</label>
        <input id="port" type="text" value="8080"/>

        <button id="startBtn" type="submit">
            <span>üöÄ</span> <span>Start</span>
        </button>
    </form>

    <!-- Status / live messages -->
    <div id="status" class="small" aria-live="polite"></div>
</div>

<script>
    // --- Show best-effort public/local IP -------------------------------------
    async function detectLocalIP() {
      const ipEl = document.getElementById('userIP');
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        if (res.ok) {
          const data = await res.json();
          if (data.ip) {
            ipEl.textContent = data.ip;
            return;
          }
        }
        ipEl.textContent = location.hostname || 'localhost';
      } catch (e) {
        ipEl.textContent = location.hostname || 'localhost';
      }
    }

    // --- Simple helper to set status style/text -------------------------------
    function setStatus(text, level) {
      const el = document.getElementById('status');
      el.textContent = text || '';
      el.classList.remove('ok', 'warn', 'error');
      if (level) el.classList.add(level);
    }

    // --- Online / offline indicator -------------------------------------------
    function updateOnlineStatus() {
      if (navigator.onLine) {
        setStatus('‚úÖ You appear online. Configure the fields above and click Start.', 'ok');
      } else {
        setStatus('‚ö†Ô∏è You are offline. Transfers will not work until the network is back.', 'warn');
      }
    }

    window.addEventListener('online',  updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    window.addEventListener('load', () => {
      detectLocalIP();
      updateOnlineStatus();
    });

    // --- Form behavior + validation -------------------------------------------
    (function () {
      const form     = document.getElementById('transferForm');
      const roleEl   = document.getElementById('role');
      const methodEl = document.getElementById('method');
      const targetEl = document.getElementById('target');
      const nameEl   = document.getElementById('name');
      const fileEl   = document.getElementById('file');
      const fileLabel = document.getElementById('fileLabel');

      // Toggle label + folder picking based on role
      function syncRoleUI() {
        const role = roleEl.value;

        // Always clear any directory attrs first
        fileEl.removeAttribute('webkitdirectory');
        fileEl.removeAttribute('directory');
        fileEl.value = '';

        if (role === 'Sender') {
          fileLabel.textContent = 'File (Sender only)';
          fileEl.disabled = false;
        } else {
          // Receiver: choose where to save incoming files (folder)
          fileLabel.textContent = 'Save Location (Receiver)';
          // Let advanced browsers choose a directory
          fileEl.setAttribute('webkitdirectory', '');
          fileEl.setAttribute('directory', '');
          fileEl.disabled = false;
        }
      }

      roleEl.addEventListener('change', syncRoleUI);
      syncRoleUI(); // initial

      form.addEventListener('submit', function (e) {
        setStatus('', null);

        const role   = roleEl.value;
        const method = methodEl.value;
        const target = targetEl.value.trim();

        // 1) Name required
        if (!nameEl.value.trim()) {
          e.preventDefault();
          setStatus('Please tell me your name üòä', 'warn');
          return;
        }

        // 2) Sender must pick at least one file
        if (role === 'Sender' && !fileEl.files.length) {
          e.preventDefault();
          setStatus('You did not pick any file. Please select at least one file.', 'error');
          return;
        }

        // 3) ZeroTier: validate Network ID format (16 hex chars)
        if (role === 'Sender' && method === 'ZeroTier') {
          const validZT = /^[0-9a-f]{16}$/i.test(target);
          if (!validZT) {
            e.preventDefault();
            setStatus(
              '‚ö†Ô∏è Invalid ZeroTier Network ID. It should be a 16-digit hexadecimal (e.g., abcd1234ef567890).',
              'error'
            );
            return;
          }
        }

        // 4) Sender + real transport => Target required
        const needsTarget =
          role === 'Sender' &&
          (method === 'HTTP' || method === 'ZeroTier' || method === 'S3');

        if (needsTarget && !target) {
          e.preventDefault();
          setStatus('Please enter the Receiver IP / URL / Bucket before starting üö¶', 'error');
          return;
        }

        // 5) Final friendly text
        if (role === 'Receiver') {
          setStatus(
            'Hi friend üëã Choose your save location (folder) and wait for the sender to start the transfer.',
            'ok'
          );
        } else {
          setStatus('Awesome üöÄ Validated. Switch to the desktop app / backend to start the real transfer.', 'ok');
        }

        // This HTML front-end is a helper UI. Prevent navigation here;
        // the Java desktop/backend handles the actual transfer.
        e.preventDefault();
      });
    })();
</script>
</body>
</html>
